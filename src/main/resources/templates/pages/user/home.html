<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout}">
<head>
  <title>GreenBridge - Home</title>
    <link rel="stylesheet" href="/static/css/chatbot.css">
    <link rel="stylesheet" href="/static/css/chat.css">
    <link rel="stylesheet" href="/static/css/typing.css">

</head>
<body>
<!-- sss-->
  <section layout:fragment="content">
      <div class="container">
          <div class="chatbox">
              <div class="chatbox__support">
                  <div class="chatbox__header">
                      <div class="chatbox__image--header">
                          <img src="/static/images/image.svg" alt="image">
                      </div>
                      <div class="chatbox__content--header">
                          <h4 class="chatbox__heading--header">Assistente Chat</h4>
                          <p class="chatbox__description--header">Ricevi suggerimenti secondo il tuo gusto!</p>
                      </div>
                  </div>
                  <div class="chatbox__messages">
                      <div>
                          <div class="messages__item messages__item--visitor">
                              Ciao, benvenuto su Greenbridge!
                          </div>
                          <div class="messages__item messages__item--visitor">
                              Sono un chatbot in grado di consigliarti gli Agricoltori pi&ugrave; affini alle tue esigenze. Digita "/start" per ricevere il tuo consiglio.
                          </div>
                          <div id="chat">
                          </div>
                      </div>
                  </div>
                  <div class="chatbox__footer">
                      <input type="text" id="input" placeholder="Scrivi un messaggio...">
                      <p class="chatbox__send--footer" id="sendButton">Invio</p>
                  </div>
              </div>
              <div class="chatbox__button">
                  <button>button</button>
              </div>
          </div>
      </div>
      <script src="/static/js/chatbotscript.js" defer></script>
      <script>
          class InteractiveChatbox {
              constructor(a, b, c) {
                  this.args = {
                      button: a,
                      chatbox: b
                  }
                  this.icons = c;
                  this.state = false;
              }

              display() {
                  const {button, chatbox} = this.args;

                  button.addEventListener('click', () => this.toggleState(chatbox))
              }

              toggleState(chatbox) {
                  this.state = !this.state;
                  this.showOrHideChatBox(chatbox, this.args.button);
              }

              showOrHideChatBox(chatbox, button) {
                  if(this.state) {
                      chatbox.classList.add('chatbox--active')
                      this.toggleIcon(true, button);
                  } else if (!this.state) {
                      chatbox.classList.remove('chatbox--active')
                      this.toggleIcon(false, button);
                  }
              }

              toggleIcon(state, button) {
                  const { isClicked, isNotClicked } = this.icons;
                  let b = button.children[0].innerHTML;

                  if(state) {
                      button.children[0].innerHTML = isClicked;
                  } else if(!state) {
                      button.children[0].innerHTML = isNotClicked;
                  }
              }
          }

          const chatButton = document.querySelector('.chatbox__button');
          const chatContent = document.querySelector('.chatbox__support');
          const icons = {
              isClicked: '<img src="/static/images/icons/chatbox-icon.svg" />',
              isNotClicked: '<img src="/static/images/icons/chatbox-icon.svg" />'
          }
          const chatbox = new InteractiveChatbox(chatButton, chatContent, icons);
          chatbox.display();
          chatbox.toggleIcon(false, chatButton);
      </script>
  </section>
</body>
</html>